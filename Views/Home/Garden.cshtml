@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Garden</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #d9f9d9, #bde0fe); min-height: 100vh; }
        .card { border-radius: 20px; border: none; box-shadow: 0 6px 25px rgba(0,0,0,0.15); }
        th, td { vertical-align: middle; text-align: center; }
        .btn { border-radius: 10px; transition: all 0.2s ease; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="card p-4">
        <h1 class="text-center mb-4 text-success">My Garden</h1>
        <div class="mb-3 d-flex justify-content-between">
            <a href="/Home/Index" class="btn btn-secondary">Back</a>
            <a href="/Plants/Create" class="btn btn-success">Add New Plant</a>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
                <thead class="table-success">
                    <tr>
                        <th>Plant Name</th>
                        <th>Planted Date</th>
                        <th>Comment</th>
                        <th>Water Every (days)</th>
                        <th>Last Watered</th>
                        <th>Water</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody id="plantTableBody">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const tableBody = document.getElementById("plantTableBody");

    async function loadPlants() {
        try {
            const response = await fetch('/api/PlantsApi'); 
            const plants = await response.json();
            renderTable(plants);
        } catch (error) {
            console.error("Error loading plants:", error);
        }
    }

    function renderTable(plants) {
        tableBody.innerHTML = "";
        plants.forEach(plant => {
            const row = document.createElement("tr");
            const pDate = new Date(plant.plantedDate).toLocaleDateString();
            const lDate = plant.lastWatered ? new Date(plant.lastWatered).toLocaleDateString() : "Never";

            row.innerHTML = `
                <td>${plant.name}</td>
                <td>${pDate}</td>
                <td>${plant.comment || "-"}</td>
                <td>${plant.waterEveryDays}</td>
                <td>${lDate}</td>
                <td>
                    <button class="btn btn-primary btn-sm" onclick="waterPlant(${plant.id})">
                        <i class="bi bi-droplet"></i>
                    </button>
                </td>
                <td>
                    <button class="btn btn-outline-danger btn-sm" onclick="deletePlant(${plant.id})">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    async function deletePlant(id) {
    if (confirm("Delete this plant?")) {
        await fetch(`/api/PlantsApi/${id}`, { method: 'DELETE' });
        loadPlants();
    }
}

    async function waterPlant(id) {
        const response = await fetch(`/api/PlantsApi/${id}`);
        const plant = await response.json();
        
        plant.lastWatered = new Date().toISOString();

        await fetch(`/api/PlantsApi/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(plant)
        });
        loadPlants();
    }

    loadPlants();
</script>
</body>
</html>